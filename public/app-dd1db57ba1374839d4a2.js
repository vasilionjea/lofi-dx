(()=>{"use strict";function e(e){return null==e}function t(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function s(e,s){const n={};for(const r of Object.keys(e))t(s,r)&&(n[r]=e[r]);return n}function n(e){return"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}function r(e,t){const s=function(e,t){let s=0,n=e.length-1,r=Math.floor(n/2);for(;e[r]!==t&&s<n;)t<e[r]?n=r-1:s=r+1,r=Math.floor((s+n)/2);return t===e[r]?r:-1}(e,t);if(-1!==s)return e.splice(s,1)[0]}new Map([["[object Undefined]","undefined"],["[object Null]","null"],["[object Boolean]","boolean"],["[object String]","string"],["[object Number]","number"],["[object Array]","array"],["[object Set]","set"],["[object Object]","object"],["[object Map]","map"],["[object Function]","function"],["[object RegExp]","regexp"],["[object Error]","error"]]);const i={a:!0,able:!0,about:!0,above:!0,across:!0,after:!0,again:!0,against:!0,ain:!0,all:!0,am:!0,an:!0,and:!0,any:!0,are:!0,aren:!0,"aren't":!0,as:!0,at:!0,be:!0,because:!0,been:!0,before:!0,being:!0,below:!0,between:!0,both:!0,but:!0,by:!0,can:!0,cannot:!0,couldn:!0,"couldn't":!0,d:!0,did:!0,didn:!0,"didn't":!0,do:!0,does:!0,doesn:!0,"doesn't":!0,doing:!0,don:!0,"don't":!0,down:!0,during:!0,each:!0,few:!0,for:!0,from:!0,further:!0,had:!0,hadn:!0,"hadn't":!0,has:!0,hasn:!0,"hasn't":!0,have:!0,haven:!0,"haven't":!0,having:!0,he:!0,her:!0,here:!0,hers:!0,herself:!0,him:!0,himself:!0,his:!0,how:!0,i:!0,if:!0,in:!0,into:!0,is:!0,isn:!0,"isn't":!0,it:!0,"it's":!0,its:!0,itself:!0,just:!0,ll:!0,m:!0,ma:!0,me:!0,mightn:!0,"mightn't":!0,more:!0,most:!0,mustn:!0,"mustn't":!0,my:!0,myself:!0,needn:!0,"needn't":!0,no:!0,nor:!0,not:!0,now:!0,o:!0,of:!0,off:!0,on:!0,once:!0,only:!0,or:!0,other:!0,our:!0,ours:!0,ourselves:!0,out:!0,over:!0,own:!0,re:!0,s:!0,same:!0,shan:!0,"shan't":!0,she:!0,"she's":!0,should:!0,"should've":!0,shouldn:!0,"shouldn't":!0,so:!0,some:!0,such:!0,t:!0,than:!0,that:!0,"that'll":!0,the:!0,their:!0,theirs:!0,them:!0,themselves:!0,then:!0,there:!0,these:!0,they:!0,this:!0,those:!0,through:!0,to:!0,too:!0,under:!0,until:!0,up:!0,ve:!0,very:!0,was:!0,wasn:!0,"wasn't":!0,we:!0,were:!0,weren:!0,"weren't":!0,what:!0,when:!0,where:!0,which:!0,while:!0,who:!0,whom:!0,why:!0,will:!0,with:!0,won:!0,"won't":!0,wouldn:!0,"wouldn't":!0,y:!0,you:!0,"you'd":!0,"you'll":!0,"you're":!0,"you've":!0,your:!0,yours:!0,yourself:!0,yourselves:!0};function o(e){return function(e){return Boolean(i[e])}(e)||!e.match(/(\w+)/g)}function a(e){const t=[];for(const s of e.split(/\s+/g))o(s)||t.push(s);return t.join(" ")}var c;!function(e){e.Invalid="Invalid",e.PresenceTerm="PresenceTerm",e.ExactTerm="ExactTerm",e.Term="Term"}(c||(c={}));const l={[c.PresenceTerm]:/(?<PresenceTerm>(?:(\s+)?([-+]))((\w{2,})|"(?:[^"]+)"))/,[c.ExactTerm]:/(?<ExactTerm>("(?:[^"]+)"))/,[c.Term]:/(?<Term>[^ ]+)/},h=new RegExp(`${l[c.PresenceTerm].source}|${l[c.ExactTerm].source}|${l[c.Term].source}`,"g"),u=/(?:[\^*()_}\]\\[{>\\<|\\/â€¦`~}^]+)/gi;class d{constructor(e,t){this.type=e,this.text=t}}function p(e=""){return e.replace(/\s+/g," ").trim()}function m(e=""){return e.replace(/["]/g,"")}const f=/s$/i,g=/(ss|i?es)$/i;function v(e){const t=[];for(const s of e.split(/\s+/g))f.test(s)&&!g.test(s)?t.push(s.replace(f,"")):t.push(s);return t.join(" ")}var b;!function(e){e[e.Simple=0]="Simple",e[e.Negated=1]="Negated",e[e.Required=2]="Required"}(b||(b={}));class y{constructor(){this.parts=[]}add(e){this.parts.push(e)}}const w=new class{getTokenType(e={}){let t=c.Invalid;return e.PresenceTerm?t=c.PresenceTerm:e.ExactTerm?t=c.ExactTerm:e.Term&&(t=c.Term),t}tokenize(e){const t=e.replace(u,""),s=[];for(const e of t.matchAll(h))if(e&&e.groups){const t=this.getTokenType(e.groups),n=(e[0]||"").trim();n&&!o(n)&&s.push(new d(t,n))}return s}},S=new class{parsePresence(e){let t=p(e.text.toLocaleLowerCase()).trim(),s=b.Simple,n=!1;return t.startsWith("-")?s=b.Negated:t.startsWith("+")&&(s=b.Required),t=function(e=""){return e.replace(/^([-+]+)/,"")}(t),t.startsWith('"')&&(t=m(t).trim(),n=!0),t=a(t),t=v(t),{term:t,type:s,isPhrase:n}}parseExact(e){let t=m(e.text.toLocaleLowerCase());return t=p(t).trim(),t=a(t),t=v(t),{term:t,type:b.Simple,isPhrase:!0}}parseSimple(e){return{term:v(e.text.toLocaleLowerCase().trim()),type:b.Simple,isPhrase:!1}}parse(e){const t=new y;if(!e||!e.length)return t;for(const s of e){let e;switch(s.type){case c.PresenceTerm:e=this.parsePresence(s);break;case c.ExactTerm:e=this.parseExact(s);break;default:e=this.parseSimple(s)}e.term&&t.add(e)}return t}};function T(e){const t=e.concat(),s=[];if(!t.length)return s;let n=parseInt(t.shift(),36);s.push(n);for(const e of t){const t=n+parseInt(e,36);s.push(t),n=t}return s}function x(e){return`${function(e){const t=[];if(!e.length)return t;for(let s=0;s<e.length;s++){const n=e[s-1],r=e[s];if(0===s)t.push(r.toString(36));else{const e=r-n;t.push(e.toString(36))}}return t}(e.positions).join(",")}`}const E=/\s+/g;class j{constructor(e){this.docTable={},this.indexTable={},this.docTermCounts={},this.totalDocs=0,this.uidKey=e.uidKey||"id",this.fields=new Set(e.fields||[]),this.docSplitter=e.splitter||E}tokenizeText(e){return p(e).toLocaleLowerCase().split(this.docSplitter)}tokensWithPositions(e){const t=[];let s=0;for(const n of e)if(!o(n)){const e=v(n),r={term:e,position:s};s+=e.length+1,t.push(r)}return t}index(t){if(e(t)||!(s=t)||!/\S+/g.test(s))return this;var s;this.fields.add(t);for(const e of Object.values(this.docTable))this.indexDocument(t,e);return this}indexDocument(t,s){var n;const r=s[this.uidKey];if(e(r)||e(s[t]))return;const i=this.tokensWithPositions(this.tokenizeText(s[t]));this.docTermCounts[r]+=i.length;for(const e of i){this.indexTable[e.term]||(this.indexTable[e.term]={});const t=this.getDocumentEntry(e.term,r);null===(n=t.positions)||void 0===n||n.push(e.position),this.indexTable[e.term][r]=x(t)}}addDocuments(t){if(e(t)||!Array.isArray(t))return this;for(const e of t){const t=e[this.uidKey];this.docTable[t]||(this.totalDocs+=1),this.docTable[t]=e,this.docTermCounts[t]=0,this.fields.forEach((t=>this.indexDocument(t,e)))}return this}loadFromStorage({fields:e,documents:t,index:s}){const[n,r,i]=t;this.fields=new Set(e),this.totalDocs=n,this.docTable=r,this.docTermCounts=i,this.indexTable=s}toJSON(){return{fields:[...this.fields],documents:[this.totalDocs,n(this.docTable),n(this.docTermCounts)],index:n(this.indexTable)}}getDocument(e){return this.docTable[e]}getDocumentCount(){return this.totalDocs}getDocumentTermCount(e){return this.docTermCounts[e]||0}getTermEntry(e){return this.indexTable[e]||{}}hasTermEntry(e){return e in this.indexTable}getDocumentEntry(e,t,s=!0){const n=this.getTermEntry(e);return s?(r=n[t])?{positions:T(r.split(","))}:{positions:[]}:n[t];var r}forEach(e){Object.keys(this.indexTable).forEach(e)}}function I({frequency:e,totalTerms:t},{totalDocs:s,totalTermDocs:n}){const r=function(e,t){return e/t}(e,t),i=function(e,t){return Math.log(e/t)}(s,n);return r*i}const C={prefixMatch:!1};class D{constructor(e,t={}){this.invertedIndex=e,this.config=Object.assign(Object.assign({},C),t)}matchesWithScores(e){const t={},s=Object.entries(e),n=this.invertedIndex.getDocumentCount(),r=s.length;for(const[e,i]of s){const s=this.invertedIndex.getDocumentTermCount(e),o=i.split(",").length;t[e]=I({frequency:o,totalTerms:s},{totalDocs:n,totalTermDocs:r})}return t}sumScores(...e){return e.reduce(((e=0,t=0)=>Number((e+t).toFixed(6))))}assignScores(e,s,n=!1){for(const[r,i]of Object.entries(s))n?t(e,r)&&(e[r]=this.sumScores(e[r],i)):e[r]=this.sumScores(e[r],i)}getSimpleMatches(e,t=!1){if(t){const t={};return this.invertedIndex.forEach((s=>{if(s.startsWith(e.term)){const e=this.matchesWithScores(this.invertedIndex.getTermEntry(s));this.assignScores(t,e)}})),t}return this.matchesWithScores(this.invertedIndex.getTermEntry(e.term))}getRequiredMatches(e){let t={};for(let n=0;n<e.length;n++){const r=e[n],i=r.isPhrase?this.getPhraseMatches(r):this.getSimpleMatches(r);if(!i){t={};break}if(0===n)t=i;else{const e=s(t,i);this.assignScores(e,i,!0),t=e}}return t}searchPhrase({candidates:t,terms:n}){const i={},o=n.length,a={},c=Object.keys(t);if(!c.length)return i;for(const t of c){for(const e of n){const s=this.invertedIndex.getDocumentEntry(e,t);a[e]=s.positions}let s=0;const c=[a[n[0]].shift()];for(;c.length&&!e(n[s+1])&&i[t]!==o;){0===s&&(i[t]=1);const o=c[c.length-1]+n[s].length+1,l=r(a[n[s+1]],o);if(e(l)){s=0,c.length=0;const t=a[n[0]].shift();e(t)||c.push(t)}else c.push(l),i[t]+=1,s++}i[t]!==o&&delete i[t]}return s(t,i)}getPhraseMatches(e){const t=e.term.split(/\s+/);if(1===t.length)return this.getSimpleMatches(e);const s=this.getRequiredMatches(t.map((e=>({term:e,isPhrase:!1}))));return this.searchPhrase({terms:t,candidates:s})}getMatches(e){const t={};for(const s of e){const e=s.type===b.Negated,n=s.type===b.Simple&&this.config.prefixMatch,r=s.isPhrase?this.getPhraseMatches(s):this.getSimpleMatches(s,n);e?Object.assign(t,r):this.assignScores(t,r)}return t}result(e,s){const n=function(e,s){const n={};for(const r of Object.keys(e))t(s,r)||(n[r]=e[r]);return n}(e,s);return Object.keys(n).sort(((e,t)=>n[t]-n[e])).map((e=>this.invertedIndex.getDocument(e)))}search(e){const t=function(e){const t={required:[],negated:[],simple:[]};for(const s of e)switch(s.type){case b.Required:t.required.push(s);break;case b.Negated:t.negated.push(s);break;case b.Simple:t.simple.push(s)}return t}(function(e=""){if(!e)return new y;const t=w.tokenize(e);return S.parse(t)}(e).parts),s=this.getMatches(t.negated);return t.required.length?this.result(this.getRequiredMatches(t.required),s):this.result(this.getMatches(t.simple),s)}}const P=new class{constructor(){const t=this.docsIndex=new j({uidKey:"id",fields:["body"],splitter:/\W+|\d+/g});this.docsSearch=function(e,t){return new D(e,{prefixMatch:!0})}(t),this.docsStorage=function(t,s={}){const n=s.storageKey||"lofi-dx:index";return{isSaved:function(){return Boolean(localStorage.getItem(n))},getKey:function(){return n},save:function({ttl:e=0}={}){return new Promise(((s,r)=>{try{const r={expiry:Date.now()+e,value:t.toJSON()};localStorage.setItem(n,JSON.stringify(r)),s(!0)}catch(e){console.error(e),r(e)}}))},load:function(){return new Promise(((s,r)=>{const i=localStorage.getItem(n);if(i)try{const r=JSON.parse(i);t.loadFromStorage(r.value||r),(e(r.expiry)||Date.now()>r.expiry)&&localStorage.removeItem(n),s(!0)}catch(e){console.error(e),r(e)}else s(!1)}))},clear:function(){return new Promise((e=>{localStorage.removeItem(n),e()}))}}}(t)}async fetch(){const e=performance.now(),t=await fetch("./data.json"),{data:s}=await t.json();this.docsIndex.addDocuments(s);const n=performance.now();console.log(`Loaded (init): ${n-e}ms`)}async loadStored(){const e=performance.now();await this.docsStorage.load();const t=performance.now();console.log(`Loaded (cache): ${t-e}ms`)}async loadDocuments(){this.docsStorage.isSaved()?await this.loadStored():(await this.fetch(),this.docsStorage.save({ttl:864e5})),console.log(this.docsIndex.toJSON())}search(e=""){if(e.length<=1)return;const t=performance.now(),s=this.docsSearch.search(e),n=performance.now();return console.log(`Search took ${n-t}ms`),s}},k=e=>document.querySelector(e);class L extends Event{constructor(e){super("statechange"),this.state=e}}class M extends EventTarget{constructor(e={}){super(),this.value=e}setState(e){this.value=e,this.dispatchEvent(new L(this.value))}getState(){return this.value}}class O extends EventTarget{get tagName(){return"div"}get classNames(){return[]}constructor(e={}){super(),this.settings={},this.settings=Object.assign(Object.assign({},this.settings),e),this._createElement()}_createElement(){this.settings.element||(this.element=document.createElement(this.tagName)),this.element.classList.add(...this.classNames)}destroy(){this.element.remove(),this.element=this.settings=null}}class N extends O{get classNames(){return["search-input"]}onInputChange(){this.input.value?this.dispatchInput():this.dispatchClear()}dispatchInput(){const e=new CustomEvent("input:value",{bubbles:!0,detail:{value:this.input.value}});this.dispatchEvent(e)}dispatchClear(){const e=new CustomEvent("input:clear",{bubbles:!0});this.dispatchEvent(e)}setValue(e){this.input&&(this.input.value=e,this.onInputChange())}reset(){var e;this.setValue(""),null===(e=this.input)||void 0===e||e.focus()}clearIconTemplate(){let e='<svg aria-hidden="true" viewBox="0 0 24 24" focusable="false" style="pointer-events: none; display: block; width: inherit; height: inherit">';return e+='<g><path d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"></path></g>','<svg aria-hidden="true" viewBox="0 0 24 24" focusable="false" style="pointer-events: none; display: block; width: inherit; height: inherit"><g><path d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"></path></g></svg>'}template(){const e="searchInput";let t=`<label id="prompt" for="${e}" class="visuallyhidden">Search national parks</label>`;return t+=`<input type="search" id="${e}" placeholder="Search for something..." aria-labelledby="prompt" autocorrect="off" spellcheck="false" autocapitalize="off">`,t+=`<button class="btn btn-icon btn-clear" aria-label="Clear search">${this.clearIconTemplate()}</button>`,t}render(){return this.element.insertAdjacentHTML("beforeend",this.template()),this.input=this.element.querySelector("input"),this.input.addEventListener("input",(()=>this.onInputChange())),this.clearButton=this.element.querySelector(".btn-clear"),this.clearButton.addEventListener("click",(e=>this.reset())),this}}const $="expanded";class q extends O{get classNames(){return["search-results"]}constructor(){super(),this.element.addEventListener("click",this)}resultsTemplate(e){return e.reduce(((e,t)=>e+`<article>${t.title}${t.body}</article>`),"")}querySuggestions(){let e='<div class="query-suggestions">';return e+="<p>Suggestions</p>",e+="<ul>",e+='<li class="pill pill--outlined">camping waterfalls -Teton</li>',e+='<li class="pill pill--outlined">"sierra nevada" +mojave</li>',e+='<li class="pill pill--outlined">southwestern Utah</li>',e+="</ul>",'<div class="query-suggestions"><p>Suggestions</p><ul><li class="pill pill--outlined">camping waterfalls -Teton</li><li class="pill pill--outlined">"sierra nevada" +mojave</li><li class="pill pill--outlined">southwestern Utah</li></ul></div>'}noResultsTemplate(){let e='<div class="no-results">';return e+="<p>No results found :(</p>",e+=this.querySuggestions(),e+"</div>"}toggle(e,t){var s;t.classList.contains($)?(t.classList.remove($),e.textContent="read more",null===(s=t.firstElementChild)||void 0===s||s.scrollIntoView()):(t.classList.add($),e.textContent="read less")}handleEvent(e){const t=e.target;t.classList.contains("see-more")&&this.toggle(t,t.parentElement)}render(e=[]){return this.element.innerHTML=e?e.length?this.resultsTemplate(e):this.noResultsTemplate():"",this}}new class extends M{constructor(e){super(),this.appService=e,this.$header=k("header"),this.$main=k("main"),this.$stats=k(".search-stats"),this.searchInput=new N,this.searchResults=new q,this.debouncedSearch=function(e,t=0,s){let n=null;return(...r)=>{n&&window.clearTimeout(n),n=window.setTimeout((()=>e.apply(s,r)),t)}}(this.search,150,this),this.addEventListener("statechange",this)}async start(){this.$header.prepend(this.searchInput.render().element),this.$main.append(this.searchResults.element);try{await this.appService.loadDocuments(),this.searchInput.addEventListener("input:value",this),this.searchInput.addEventListener("input:clear",this),this.searchInput.setValue('"sierra nevada" california')}catch(e){console.error(e)}}search(e){const t=this.appService.search(e);this.setState({results:t})}handleEvent(e){const{type:t,detail:s}=e;"input:value"===t&&this.debouncedSearch(s.value),"input:clear"===t&&this.setState({results:null}),"statechange"===t&&this.renderResults()}renderResults(){const{results:e}=this.getState();this.searchResults.render(e),this.renderStats(e)}renderStats(e){let t="";if(!e)return void(this.$stats.textContent=t);const s=e.length;0===s?t="no results found":1===s?t="1 result found":s>1&&(t=`${s} results found`),this.$stats.textContent=t}}(P).start()})();